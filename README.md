# 抓包重放工具 (Packet Replay Tool)

专为TrollStore设计的iOS抓包与重放工具，可以在iPhone上直接抓取网络包并定时重放。

## 功能特性

✅ **全局抓包** - 抓取手机上所有应用的网络流量
✅ **协议支持** - 支持HTTP/HTTPS/TCP/UDP协议
✅ **包详情查看** - 查看完整的包内容、headers、十六进制数据
✅ **立即重放** - 选择任意包立即重放
✅ **定时重放** - 精确设置重放时间（精确到毫秒）
✅ **重复模式** - 支持一次性、每小时、每天重复执行
✅ **后台运行** - 支持后台执行定时任务
✅ **本地通知** - 重放完成后发送通知

## 系统要求

- iOS 14.0 或更高版本
- 已安装 TrollStore
- arm64 设备（iPhone 6s及以上）

## 安装步骤

### 方法一：使用预编译的IPA（推荐）

1. 下载 `PacketReplay.ipa` 文件
2. 通过AirDrop、文件共享等方式传输到iOS设备
3. 在TrollStore中打开IPA文件
4. 点击"安装"按钮
5. 等待安装完成

### 方法二：从源码构建

需要macOS和Xcode环境：

```bash
# 进入项目目录
cd PacketReplay

# 使用Makefile构建
make build

# 或者使用构建脚本
chmod +x build.sh
./build.sh

# 生成的IPA文件将在当前目录
# 传输到iOS设备并用TrollStore安装
```

## 使用说明

### 1. 开始抓包

1. 打开应用
2. 点击"开始抓包"按钮
3. 应用将开始捕获所有网络流量
4. 抓取的包会实时显示在列表中

### 2. 查看包详情

1. 在"抓取的包"列表中点击任意包
2. 查看包的详细信息：
   - 基本信息（时间、进程、协议）
   - 网络信息（源/目标IP和端口）
   - HTTP headers（如果是HTTP请求）
   - 数据内容（文本和十六进制）

### 3. 立即重放

**方法一：**
1. 在包列表中向左滑动
2. 点击"立即重放"
3. 确认后立即发送

**方法二：**
1. 打开包详情
2. 点击右上角"重放"按钮

### 4. 定时重放

1. 在包列表中向左滑动目标包
2. 点击"定时重放"
3. 设置执行时间（可精确到秒）
4. 选择重复模式：
   - **仅一次** - 只在指定时间执行一次
   - **每小时** - 每小时在指定分钟执行
   - **每天** - 每天在指定时间执行
5. 点击"设置定时重放"

### 5. 管理定时任务

1. 切换到"定时任务"标签
2. 查看所有已设置的任务
3. 向左滑动可删除任务
4. 任务会在后台自动执行

### 6. 停止抓包

1. 点击"停止抓包"按钮
2. 已抓取的包会自动保存

## 使用场景

### 场景1：定时抢购
```
1. 手动操作一次购买流程，抓取请求包
2. 找到提交订单的请求包
3. 设置定时重放到抢购时间（如10:00:00）
4. 应用会在精确时间自动发送请求
```

### 场景2：自动签到
```
1. 手动签到一次，抓取签到请求
2. 设置每天定时重放（如每天9:00）
3. 应用会每天自动执行签到
```

### 场景3：接口测试
```
1. 抓取API请求
2. 查看请求详情和返回结果
3. 重复发送测试不同场景
```

## 注意事项

⚠️ **重要提示**

1. **TrollStore专用** - 本工具必须通过TrollStore安装，普通安装方式无法获得所需权限

2. **网络权限** - 首次运行时需要授予网络权限

3. **通知权限** - 建议授予通知权限以接收任务执行通知

4. **HTTPS限制** - 抓取HTTPS流量可能受到SSL Pinning限制，某些应用的加密流量可能无法完整解析

5. **后台限制** - iOS对后台任务有时间限制，长时间后台可能被系统终止

6. **合法使用** - 仅用于个人测试和学习，不得用于非法用途

7. **数据安全** - 抓取的包包含敏感信息，请妥善保管

## 数据存储

- 抓取的包存储在：`Documents/packets.json`
- 定时任务存储在：`Documents/tasks.json`
- 应用卸载后数据会被清除

## 故障排除

### 问题1：无法抓包
- 检查是否已点击"开始抓包"
- 确认应用有网络权限
- 重启应用后重试

### 问题2：重放失败
- 检查网络连接
- 确认目标服务器可访问
- 某些请求可能需要特定的认证信息

### 问题3：定时任务未执行
- 检查应用是否在后台运行
- 确认时间设置正确
- 查看通知权限是否开启

### 问题4：无法安装
- 确认已安装TrollStore
- 检查iOS版本是否兼容
- 尝试重新下载IPA文件

## 技术细节

- **开发语言**: Swift
- **最低iOS版本**: 14.0
- **架构**: arm64
- **框架**: UIKit, Network, UserNotifications
- **抓包原理**: URLProtocol拦截 + NWListener监听

## 项目结构

```
PacketReplay/
├── Sources/
│   ├── AppDelegate.swift          # 应用入口
│   ├── PacketModel.swift          # 数据模型
│   ├── PacketCapture.swift        # 抓包核心
│   ├── PacketReplay.swift         # 重放功能
│   ├── SchedulerManager.swift     # 定时调度
│   ├── MainViewController.swift   # 主界面
│   └── ViewControllers.swift      # 其他界面
├── Resources/
│   └── LaunchScreen.storyboard    # 启动页面
├── Info.plist                     # 应用配置
├── Entitlements.plist             # 权限配置
├── Makefile                       # 构建配置
├── build.sh                       # 构建脚本
└── README.md                      # 说明文档
```

## 免责声明

本工具仅供学习和个人测试使用。使用本工具产生的任何后果由使用者自行承担。开发者不对使用本工具造成的任何损失或法律问题负责。

请遵守当地法律法规，不要将本工具用于：
- 未经授权的网络监控
- 侵犯他人隐私
- 破坏网络安全
- 其他非法活动

## 版本历史

### v1.0 (2025-12-11)
- ✨ 初始版本发布
- ✅ 支持HTTP/HTTPS/TCP/UDP抓包
- ✅ 支持立即重放和定时重放
- ✅ 支持重复模式（一次性、每小时、每天）
- ✅ 完整的UI界面
- ✅ 后台任务支持

## 许可证

本项目仅供学习交流使用，未设置特定开源许可证。

---

**开发者**: Claude Code
**版本**: 1.0
**更新日期**: 2025-12-11
